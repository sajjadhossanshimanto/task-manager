<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --bg-color: #121212;
      --text-color: #ffffff;
      --card-color: #1e1e1e;
      --accent-color: #00bfa5;
      --completed-color: #555;
      --danger-color: #ff5252;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    .container-box {
      display: flex;
      gap: 2rem;
      width: 100%;
      max-width: 1000px;
      margin-top: 1rem;
    }
    .task-column {
      flex: 2;
    }
    .category-column {
      flex: 1;
    }
    h1 {
      text-align: center;
      color: var(--accent-color);
    }
    #currentTime {
      font-size: 1.2rem;
      color: #ccc;
      margin-bottom: 1rem;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: var(--card-color);
      margin: 10px 0;
      padding: 6px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: grab;
      height: 42px;
    }
    li.completed {
      text-decoration: line-through;
      background: var(--completed-color);
      color: #aaa;
    }
    .delete-btn {
      background: none;
      color: var(--danger-color);
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      margin-left: 10px;
    }
    .task-text {
      flex-grow: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 10px;
    }
    .task-name {
      font-weight: bold;
      font-size: 1em;
    }
    .task-time {
      font-size: 0.85em;
      color: #ccc;
      text-align: right;
      white-space: nowrap;
      min-width: 170px;
    }
    .form-inline {
      background: var(--card-color);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      margin-top: 1rem;
    }
    .form-inline input,
    .form-inline select {
      background-color: #333;
      color: #fff;
      border: 1px solid #555;
    }
    .category-list {
      background: var(--card-color);
      padding: 15px;
      border-radius: 10px;
    }
    .category-tag {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .category-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .color-swatch {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #fff;
      cursor: pointer;
    }
    .color-swatch.selected {
      outline: 2px solid var(--accent-color);
    }

  </style>
</head>
<body>
  <h1>Task Manager</h1>
  <div id="currentTime"></div>

  <div class="container-box">
    <div class="task-column">
      <form class="form-inline row g-2" onsubmit="handleTaskForm(event)">
        <div class="col-md-5">
          <input type="text" id="taskName" class="form-control" placeholder="Task Name" required />
        </div>
        <div class="col-md-3">
          <input type="number" id="taskDuration" class="form-control" placeholder="Duration (min)" required />
        </div>
        <div class="col-md-3">
          <div class="input-group">
            <select id="taskCategory" class="form-select"></select>
            <button class="btn btn-outline-light" type="button" onclick="createCategory()">➕</button>
          </div>
        </div>
        <div class="col-md-1">
          <button class="btn btn-success w-100">Add</button>
        </div>
      </form>

      <ul id="taskList"></ul>
    </div>

    <div class="category-column">
      <div class="category-list" id="categoryList"></div>
      <hr class="text-secondary" />
      <form id="categoryForm" class="mt-3">
        <div class="mb-2">
          <input type="text" id="newCategoryName" class="form-control" placeholder="New Category Name" required>
        </div>
        <div class="mb-2">
          <label class="form-label d-block mb-1">Choose Color:</label>
          <div id="colorPalette" class="d-flex flex-wrap gap-2">
            <!-- Color options rendered by JS -->
          </div>
          <input type="color" id="customColor" class="form-control form-control-color mt-2" title="Pick a custom color">
        </div>
        <button type="submit" class="btn btn-outline-light w-100">Create Category</button>
      </form>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    let taskList = JSON.parse(localStorage.getItem("taskList")) || [];
    let categories = JSON.parse(localStorage.getItem("categories")) || [
      { name: "General", color: "#00bfa5" }
    ];

    function saveTasks() {
      localStorage.setItem("taskList", JSON.stringify(taskList));
    }
    function saveCategories() {
      localStorage.setItem("categories", JSON.stringify(categories));
    }

    function updateCurrentTime() {
      const now = new Date();
      document.getElementById("currentTime").innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      renderTasks();
    }

    function renderTasks() {
      const ul = document.getElementById("taskList");
      ul.innerHTML = "";
      let startTime = new Date();

      taskList.forEach((task, index) => {
        const li = document.createElement("li");
        li.className = task.completed ? "completed" : "";
        const cat = categories.find(c => c.name === task.category);
        if (cat) li.style.borderLeft = `8px solid ${cat.color}`;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = task.completed;
        checkbox.onchange = () => {
          task.completed = checkbox.checked;
          saveTasks();
          renderTasks();
        };

        const textSpan = document.createElement("span");
        textSpan.className = "task-text";

        const nameSpan = document.createElement("span");
        nameSpan.className = "task-name";
        nameSpan.textContent = task.name;

        const timeSpan = document.createElement("span");
        timeSpan.className = "task-time";

        if (!task.completed) {
          const endTime = new Date(startTime.getTime() + task.duration * 60000);
          const hrs = Math.floor(task.duration / 60);
          const mins = task.duration % 60;
          const durationStr = `${hrs > 0 ? hrs + 'h ' : ''}${mins}m`;
          timeSpan.textContent = `${durationStr} — Ends: ${endTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
          startTime = endTime;
        } else {
          timeSpan.textContent = `Completed`;
        }

        timeSpan.ondblclick = () => {
          if (task.completed) return;
          const input = document.createElement("input");
          input.type = "number";
          input.min = "1";
          input.value = task.duration;
          input.style.width = "60px";
          input.style.fontSize = "0.85em";
          timeSpan.textContent = "";
          timeSpan.appendChild(input);
          input.focus();
          input.addEventListener("blur", () => {
            const newDuration = parseInt(input.value);
            if (!isNaN(newDuration) && newDuration > 0) {
              task.duration = newDuration;
              saveTasks();
              renderTasks();
            } else {
              renderTasks();
            }
          });
          input.addEventListener("keydown", e => {
            if (e.key === "Enter") input.blur();
            if (e.key === "Escape") renderTasks();
          });
        };

        textSpan.appendChild(nameSpan);
        textSpan.appendChild(timeSpan);

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.innerHTML = "🗑️";
        deleteBtn.onclick = () => {
          taskList.splice(index, 1);
          saveTasks();
          renderTasks();
        };

        li.appendChild(checkbox);
        li.appendChild(textSpan);
        li.appendChild(deleteBtn);
        ul.appendChild(li);
      });
    }

    function updateCategoryDropdown() {
      const select = document.getElementById("taskCategory");
      select.innerHTML = categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join("");
      const list = document.getElementById("categoryList");
      list.innerHTML = categories.map(cat => `
        <div class="category-tag">
          <div class="category-color" style="background:${cat.color}"></div>
          <span>${cat.name}</span>
        </div>`).join("");
    }

    function handleTaskForm(e) {
      e.preventDefault();
      const name = document.getElementById('taskName').value;
      const duration = parseInt(document.getElementById('taskDuration').value);
      const category = document.getElementById('taskCategory').value;
      if (!name || isNaN(duration) || duration <= 0) {
        alert("Invalid input");
        return;
      }
      taskList.push({ name, duration, completed: false, category });
      saveTasks();
      renderTasks();
      e.target.reset();
    }

    function createCategory() {
      const name = prompt("Enter category name:");
      if (!name) return;

      const colorInput = document.createElement("input");
      colorInput.type = "color";
      colorInput.value = "#00bfa5";
      colorInput.style.position = "fixed";
      colorInput.style.left = "-1000px";
      document.body.appendChild(colorInput);
      colorInput.click();
      colorInput.addEventListener("input", () => {
        const color = colorInput.value;
        categories.push({ name, color });
        saveCategories();
        updateCategoryDropdown();
        document.body.removeChild(colorInput);
      });
    }

    new Sortable(document.getElementById('taskList'), {
      animation: 150,
      onEnd: function(evt) {
        const movedItem = taskList.splice(evt.oldIndex, 1)[0];
        taskList.splice(evt.newIndex, 0, movedItem);
        saveTasks();
        renderTasks();
      }
    });

    const paletteColors = ["#00bfa5", "#e91e63", "#ffc107", "#3f51b5", "#8bc34a", "#ff5722", "#9c27b0"];
    let selectedColor = paletteColors[0];

    function renderColorPalette() {
      const container = document.getElementById("colorPalette");
      container.innerHTML = "";
      paletteColors.forEach(color => {
        const swatch = document.createElement("div");
        swatch.className = "color-swatch";
        swatch.style.backgroundColor = color;
        if (color === selectedColor) swatch.classList.add("selected");
        swatch.onclick = () => {
          selectedColor = color;
          renderColorPalette();
        };
        container.appendChild(swatch);
      });

      const custom = document.getElementById("customColor");
      custom.value = selectedColor;
      custom.onchange = () => {
        selectedColor = custom.value;
        renderColorPalette();
      };
    }

    document.getElementById("categoryForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const nameInput = document.getElementById("newCategoryName");
      const name = nameInput.value.trim();
      if (!name) return;

      if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
        alert("Category already exists!");
        return;
      }

      categories.push({ name, color: selectedColor });
      saveCategories();
      updateCategoryDropdown();
      nameInput.value = "";
    });

    renderColorPalette();


    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);
    updateCategoryDropdown();
  </script>
</body>
</html>
